### 一、citu_app.py

#### **1.ask_agent()**

最重要的 api: /api/v0/ask_agent 

POST  [http://localhost:8084/api/v0/ask_agent](http://localhost:8084/api/v0/ask_agent)

#### 2.QA反馈系统(点赞/点踩)的API说明

||||
|-|-|-|
|API端点|方法|功能描述|
|`/api/v0/qa_feedback/query`|POST|查询反馈记录（支持分页、筛选、排序）|
|`/api/v0/qa_feedback/delete/{feedback_id}`|DELETE|删除指定反馈记录|
|`/api/v0/qa_feedback/update/{feedback_id}`|PUT|修改指定反馈记录|
|`/api/v0/qa_feedback/add_to_training`|POST|批量添加到训练集|
|`/api/v0/qa_feedback/add`|POST|创建新的反馈记录|
|`/api/v0/qa_feedback/stats`|GET|获取反馈统计信息|


#### 3.历史对话记录及管理(redis) API 说明 

GET   [http://localhost:8084/api/v0/user/guest/conversations?limit=](http://localhost:8084/api/v0/user/guest/conversations?limit=)  N 

GET   [http://localhost:8084/api/v0/user/guest/conversations?limit=5](http://localhost:8084/api/v0/user/guest/conversations?limit=5)

GET   [http://localhost:8084/api/v0/conversation/conv_id/messages](http://localhost:8084/api/v0/conversation/conv_id/messages) 

GET   [http://localhost:8084/api/v0/conversation/conv_1751202425_d04139e4/messages](http://localhost:8084/api/v0/conversation/conv_1751202425_d04139e4/messages)

 GET   [http://localhost:8084/api/v0/conversation_stats](http://localhost:8084/api/v0/conversation_stats) 

POST  [http://localhost:8084/api/v0/conversation_cleanup](http://localhost:8084/api/v0/conversation_cleanup)

GET  [http://localhost:8084/api/v0/embedding_cache_stats](http://localhost:8084/api/v0/embedding_cache_stats)

POST:  [http://localhost:8084/api/v0/embedding_cache_cleanup](http://localhost:8084/api/v0/embedding_cache_cleanup)



#### 4.训练数据管理API说明

||||
|-|-|-|
|API端点|方法|功能描述|
|`/training_data/stats`|GET|获取训练数据统计信息|
|`/training_data/query`|POST|分页查询训练数据，支持筛选和搜索|
|`/training_data/create`|POST|创建训练数据，支持单条和批量操作|
|`/training_data/delete`|POST|删除训练数据，支持批量操作|


#### 5.Training API 训练数据集产生与加载过程说明

||||
|-|-|-|
||端点|描述|
|`POST`|`/api/v0/data_pipeline/tasks`|创建数据训练任务|
|`POST`|`/api/v0/data_pipeline/tasks/{task_id}/execute`|执行数据训练任务|
|`GET`|`/api/v0/data_pipeline/tasks/{task_id}`|获取任务状态|
|`GET`|`/api/v0/data_pipeline/tasks`|获取任务列表|
|`DELETE`|`/api/v0/data_pipeline/tasks`|删除任务（批量）|


||||
|-|-|-|
|方法|端点|描述|
|`POST`|`/api/v0/database/tables`|查询数据库表列表|
|`POST`|`/api/v0/data_pipeline/tasks/{task_id}/table-list`|在线提交表名列表|
|`POST`|`/api/v0/data_pipeline/tasks/{task_id}/upload-table-list`|上传表清单文件|
|`GET`|`/api/v0/data_pipeline/tasks/{task_id}/table-list-info`|获取表清单文件信息|


||||
|-|-|-|
|方法|端点|描述|
|`GET`|`/api/v0/data_pipeline/tasks/{task_id}/files`|查看任务文件列表|
|`GET`|`/api/v0/data_pipeline/tasks/{task_id}/files/{file_name}`|下载任务文件|
|`POST`|`/api/v0/data_pipeline/tasks/{task_id}/files`|上传文件到任务目录|


||||
|-|-|-|
|方法|端点|描述|
|`GET`|`/api/v0/data_pipeline/tasks/{task_id}/files`|查看任务文件列表|
|`GET`|`/api/v0/data_pipeline/tasks/{task_id}/files/{file_name}`|下载任务文件|
|`POST`|`/api/v0/data_pipeline/tasks/{task_id}/files`|上传文件到任务目录|


||||
|-|-|-|
|方法|端点|描述|
|`POST`|`/api/v0/data_pipeline/tasks/{task_id}/execute`|执行单个步骤（分步模式）|


||||
|-|-|-|
|方法|端点|描述|
|`POST`|`/api/v0/data_pipeline/tasks`|创建训练任务|
|`POST`|`/api/v0/database/tables`|查询业务数据库表名列表|
|`POST`|`/api/v0/data_pipeline/tasks/{task_id}/table-list`|在线提交表名列表|
|`POST`|`/api/v0/data_pipeline/tasks/{task_id}/upload-table-list`|上传表清单文件|


|||||
|-|-|-|-|
|API端点|功能|必需参数|可选参数|
|`POST /api/v0/database/tables`|获取数据库表列表|无|`db_connection`,`schema`,`table_name_pattern`|
|`POST /api/v0/database/table/ddl`|获取表DDL和结构分析|`table`|`db_connection`,`business_context`,`type`|


