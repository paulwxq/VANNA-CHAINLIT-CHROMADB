[
  {
    "question": "统计各服务区2023年4月1日当天的营收总额并按金额降序排列",
    "sql": "SELECT s.service_area_name AS 服务区名称, b.pay_sum AS 营收总额 FROM bss_business_day_data b JOIN bss_service_area s ON b.service_no = s.service_area_no WHERE b.oper_date = '2023-04-01' AND b.delete_ts IS NULL AND s.delete_ts IS NULL ORDER BY b.pay_sum DESC;"
  },
  {
    "question": "查询最近7天各服务区日均订单数量TOP10",
    "sql": "SELECT service_name AS 服务区名称, AVG(order_sum) AS 日均订单量 FROM bss_business_day_data WHERE oper_date >= CURRENT_DATE - INTERVAL '7 days' AND delete_ts IS NULL GROUP BY service_name ORDER BY 日均订单量 DESC LIMIT 10;"
  },
  {
    "question": "分析2023年4月各服务区微信支付占比超过50%的记录",
    "sql": "SELECT service_name AS 服务区名称, oper_date AS 统计日期, (wx / pay_sum * 100)::numeric(5,2) AS 微信占比 FROM bss_business_day_data WHERE oper_date BETWEEN '2023-04-01' AND '2023-04-30' AND wx / pay_sum > 0.5 AND delete_ts IS NULL;"
  },
  {
    "question": "统计2023年Q2各服务区月均营收及环比增长率",
    "sql": "WITH monthly_data AS (SELECT service_no, date_trunc('month', oper_date) AS 月份, SUM(pay_sum) AS 月营收 FROM bss_business_day_data WHERE oper_date BETWEEN '2023-04-01' AND '2023-06-30' AND delete_ts IS NULL GROUP BY service_no, 月份) SELECT service_no AS 服务区编码, 月份, 月营收, LAG(月营收) OVER(PARTITION BY service_no ORDER BY 月份) AS 上月营收, ((月营收 - LAG(月营收) OVER(PARTITION BY service_no ORDER BY 月份))/NULLIF(LAG(月营收) OVER(PARTITION BY service_no ORDER BY 月份),0)*100)::numeric(5,2) AS 环比增长率 FROM monthly_data;"
  },
  {
    "question": "对比2023年五一假期与日常服务区营收情况（4月29日-5月3日 vs 4月1-7日）",
    "sql": "SELECT '五一假期' AS 时段, SUM(pay_sum) AS 总营收, COUNT(DISTINCT service_no) AS 服务区数量 FROM bss_business_day_data WHERE oper_date BETWEEN '2023-04-29' AND '2023-05-03' AND delete_ts IS NULL UNION ALL SELECT '日常时段', SUM(pay_sum), COUNT(DISTINCT service_no) FROM bss_business_day_data WHERE oper_date BETWEEN '2023-04-01' AND '2023-04-07' AND delete_ts IS NULL;"
  },
  {
    "question": "查询最近一天各服务区现金支付订单占比超过20%的异常记录",
    "sql": "SELECT service_name AS 服务区名称, rmb_order AS 现金订单数, order_sum AS 总订单数, (rmb_order::numeric/order_sum*100)::numeric(5,2) AS 现金占比 FROM bss_business_day_data WHERE oper_date = (SELECT MAX(oper_date) FROM bss_business_day_data WHERE delete_ts IS NULL) AND order_sum > 0 AND rmb_order::numeric/order_sum > 0.2 AND delete_ts IS NULL;"
  },
  {
    "question": "统计各公司下属服务区2023年Q2月均营收对比",
    "sql": "SELECT c.company_name AS 公司名称, date_trunc('month', b.oper_date) AS 月份, AVG(b.pay_sum) AS 月均营收 FROM bss_business_day_data b JOIN bss_service_area s ON b.service_no = s.service_area_no JOIN bss_company c ON s.company_id = c.id WHERE b.oper_date BETWEEN '2023-04-01' AND '2023-06-30' AND b.delete_ts IS NULL AND s.delete_ts IS NULL AND c.delete_ts IS NULL GROUP BY c.company_name, 月份 ORDER BY 月份, 公司名称;"
  },
  {
    "question": "查询2023年6月15日各时段（早/中/晚）各支付方式订单量分布",
    "sql": "SELECT '上午' AS 时段, SUM(wx_order) AS 微信订单, SUM(zf_order) AS 支付宝订单, SUM(rmb_order) AS 现金订单 FROM bss_business_day_data WHERE oper_date = '2023-06-15' AND create_ts::time < '12:00:00' AND delete_ts IS NULL UNION ALL SELECT '下午', SUM(wx_order), SUM(zf_order), SUM(rmb_order) FROM bss_business_day_data WHERE oper_date = '2023-06-15' AND create_ts::time BETWEEN '12:00:00' AND '18:00:00' AND delete_ts IS NULL UNION ALL SELECT '晚上', SUM(wx_order), SUM(zf_order), SUM(rmb_order) FROM bss_business_day_data WHERE oper_date = '2023-06-15' AND create_ts::time > '18:00:00' AND delete_ts IS NULL;"
  },
  {
    "question": "分析各服务区周日均营收与平日差异（取最近3个月数据）",
    "sql": "SELECT service_name AS 服务区名称, AVG(CASE WHEN EXTRACT(DOW FROM oper_date) = 0 THEN pay_sum ELSE NULL END) AS 周日均营收, AVG(CASE WHEN EXTRACT(DOW FROM oper_date) BETWEEN 1 AND 5 THEN pay_sum ELSE NULL END) AS 工作日均营收, (AVG(CASE WHEN EXTRACT(DOW FROM oper_date) = 0 THEN pay_sum ELSE NULL END)/NULLIF(AVG(CASE WHEN EXTRACT(DOW FROM oper_date) BETWEEN 1 AND 5 THEN pay_sum ELSE NULL END),0)-1)*100 AS 差异百分比 FROM bss_business_day_data WHERE oper_date >= CURRENT_DATE - INTERVAL '3 months' AND delete_ts IS NULL GROUP BY service_name HAVING AVG(CASE WHEN EXTRACT(DOW FROM oper_date) BETWEEN 1 AND 5 THEN pay_sum ELSE NULL END) > 0;"
  },
  {
    "question": "查询2023年各服务区最大单日营收及对应日期",
    "sql": "SELECT DISTINCT ON (service_name) service_name AS 服务区名称, oper_date AS 统计日期, pay_sum AS 营收金额 FROM bss_business_day_data WHERE delete_ts IS NULL AND pay_sum IS NOT NULL ORDER BY service_name, pay_sum DESC;"
  },
  {
    "question": "统计2023年4月各服务区每日车流总量趋势，按日期排序",
    "sql": "SELECT count_date AS \"统计日期\", service_area_id AS \"服务区ID\", SUM(customer_count) AS \"当日车流量\" FROM bss_car_day_count WHERE count_date BETWEEN '2023-04-01' AND '2023-04-30' AND delete_ts IS NULL GROUP BY count_date, service_area_id ORDER BY count_date;"
  },
  {
    "question": "查询2023年4月各车型占比分布，按占比降序排列",
    "sql": "SELECT car_type AS \"车辆类型\", SUM(customer_count) AS \"总车数\", ROUND(SUM(customer_count)*100/(SELECT SUM(customer_count) FROM bss_car_day_count WHERE count_date BETWEEN '2023-04-01' AND '2023-04-30' AND delete_ts IS NULL),2) AS \"占比(%)\" FROM bss_car_day_count WHERE count_date BETWEEN '2023-04-01' AND '2023-04-30' AND delete_ts IS NULL GROUP BY car_type ORDER BY \"总车数\" DESC;"
  },
  {
    "question": "识别2023年Q2季度车流高峰时段（按周几统计），显示周一至周日平均车流量",
    "sql": "SELECT EXTRACT(ISODOW FROM count_date) AS \"星期\", ROUND(AVG(customer_count),0) AS \"平均车流量\" FROM bss_car_day_count WHERE count_date BETWEEN '2023-04-01' AND '2023-06-30' AND delete_ts IS NULL GROUP BY EXTRACT(ISODOW FROM count_date) ORDER BY \"星期\";"
  },
  {
    "question": "对比2023年4月城际车辆与过境车辆日均车流量差异",
    "sql": "SELECT car_type AS \"车辆类型\", ROUND(AVG(customer_count),0) AS \"日均车流量\" FROM bss_car_day_count WHERE count_date BETWEEN '2023-04-01' AND '2023-04-30' AND car_type IN ('城际','过境') AND delete_ts IS NULL GROUP BY car_type;"
  },
  {
    "question": "查询2023年4月车流总量TOP5服务区，显示公司名称和车流总量",
    "sql": "SELECT s.service_area_name AS \"服务区名称\", c.company_name AS \"所属公司\", SUM(cc.customer_count) AS \"车流总量\" FROM bss_car_day_count cc JOIN bss_service_area sa ON cc.service_area_id = sa.id JOIN bss_company c ON sa.company_id = c.id WHERE cc.count_date BETWEEN '2023-04-01' AND '2023-04-30' AND cc.delete_ts IS NULL AND sa.delete_ts IS NULL GROUP BY s.service_area_name, c.company_name ORDER BY \"车流总量\" DESC LIMIT 5;"
  },
  {
    "question": "分析清明节假期（2023-04-05至2023-04-07）各服务区车流环比变化率",
    "sql": "WITH holiday AS (SELECT service_area_id, SUM(customer_count) AS cnt FROM bss_car_day_count WHERE count_date BETWEEN '2023-04-05' AND '2023-04-07' AND delete_ts IS NULL GROUP BY service_area_id), pre_holiday AS (SELECT service_area_id, SUM(customer_count) AS cnt FROM bss_car_day_count WHERE count_date BETWEEN '2023-03-29' AND '2023-03-31' AND delete_ts IS NULL GROUP BY service_area_id) SELECT h.service_area_id AS \"服务区ID\", ROUND((h.cnt/p.cnt-1)*100,2) AS \"环比增长率(%)\" FROM holiday h JOIN pre_holiday p ON h.service_area_id = p.service_area_id;"
  },
  {
    "question": "查询2023年4月每日危化品车辆明细，包含服务区名称和具体车数",
    "sql": "SELECT sa.service_area_name AS \"服务区名称\", cc.count_date AS \"统计日期\", cc.customer_count AS \"危化品车数\" FROM bss_car_day_count cc JOIN bss_service_area sa ON cc.service_area_id = sa.id WHERE cc.car_type = '危化品' AND cc.count_date BETWEEN '2023-04-01' AND '2023-04-30' AND cc.delete_ts IS NULL ORDER BY cc.count_date DESC;"
  },
  {
    "question": "统计2023年Q2各服务区月均车流增长率（对比3月数据）",
    "sql": "WITH mar_data AS (SELECT service_area_id, SUM(customer_count) AS mar_cnt FROM bss_car_day_count WHERE count_date BETWEEN '2023-03-01' AND '2023-03-31' AND delete_ts IS NULL GROUP BY service_area_id), q2_data AS (SELECT service_area_id, SUM(customer_count)/3 AS avg_month_cnt FROM bss_car_day_count WHERE count_date BETWEEN '2023-04-01' AND '2023-06-30' AND delete_ts IS NULL GROUP BY service_area_id) SELECT q2.service_area_id AS \"服务区ID\", ROUND((q2.avg_month_cnt/mar.mar_cnt-1)*100,2) AS \"月均增长率(%)\" FROM q2_data q2 JOIN mar_data mar ON q2.service_area_id = mar.service_area_id;"
  },
  {
    "question": "识别2023年4月过夜车辆（19:00-7:00）占比超过30%的服务区",
    "sql": "SELECT '未提供时段数据' AS \"说明\"; -- 因现有表无时段数据需扩展，示例展示逻辑结构：SELECT sa.service_area_name FROM bss_car_day_count cc JOIN bss_service_area sa ON cc.service_area_id = sa.id WHERE cc.night_count/cc.total_count > 0.3 GROUP BY sa.service_area_name;"
  },
  {
    "question": "查询2023年4月各公司管辖服务区车流密度（车流量/服务区数量）",
    "sql": "SELECT c.company_name AS \"公司名称\", SUM(cc.customer_count) AS \"总车流量\", COUNT(DISTINCT sa.id) AS \"服务区数量\", ROUND(SUM(cc.customer_count)/COUNT(DISTINCT sa.id),0) AS \"车流密度\" FROM bss_car_day_count cc JOIN bss_service_area sa ON cc.service_area_id = sa.id JOIN bss_company c ON sa.company_id = c.id WHERE cc.count_date BETWEEN '2023-04-01' AND '2023-04-30' AND cc.delete_ts IS NULL AND sa.delete_ts IS NULL GROUP BY c.company_name;"
  },
  {
    "question": "统计最近一个月各路段关联服务区的总营收并按金额降序排名",
    "sql": "SELECT sr.section_name AS 路段名称, SUM(bbd.pay_sum) AS 总营收 FROM bss_section_route sr JOIN bss_section_route_area_link link ON sr.id = link.section_route_id JOIN bss_business_day_data bbd ON link.service_area_id = bbd.service_area_id WHERE bbd.oper_date >= CURRENT_DATE - INTERVAL '1 month' AND bbd.delete_ts IS NULL GROUP BY sr.section_name ORDER BY 总营收 DESC;"
  },
  {
    "question": "计算各路段单位车流量产生的平均营收（单位：元/车）并排名",
    "sql": "SELECT sr.section_name AS 路段名称, ROUND(SUM(bbd.pay_sum)/SUM(car.customer_count), 2) AS 单位车流营收 FROM bss_section_route sr JOIN bss_section_route_area_link link ON sr.id = link.section_route_id JOIN bss_business_day_data bbd ON link.service_area_id = bbd.service_area_id JOIN bss_car_day_count car ON bbd.service_area_id = car.service_area_id AND bbd.oper_date = car.count_date WHERE bbd.delete_ts IS NULL AND car.delete_ts IS NULL GROUP BY sr.section_name ORDER BY 单位车流营收 DESC;"
  },
  {
    "question": "对比本年度各路段每月营收环比增长率（与上月相比）",
    "sql": "WITH monthly_revenue AS (SELECT sr.section_name, DATE_TRUNC('month', bbd.oper_date) AS 月份, SUM(bbd.pay_sum) AS 月营收 FROM bss_section_route sr JOIN bss_section_route_area_link link ON sr.id = link.section_route_id JOIN bss_business_day_data bbd ON link.service_area_id = bbd.service_area_id WHERE EXTRACT(YEAR FROM bbd.oper_date) = EXTRACT(YEAR FROM CURRENT_DATE) AND bbd.delete_ts IS NULL GROUP BY sr.section_name, 月份) SELECT section_name AS 路段名称, 月份, 月营收, LAG(月营收,1) OVER (PARTITION BY section_name ORDER BY 月份) AS 上月营收, ROUND((月营收 - 上月营收)/NULLIF(上月营收,0)*100,2) AS 环比增长率 FROM monthly_revenue ORDER BY 月份, 路段名称;"
  },
  {
    "question": "查询昌栗路段下各服务区近7天营收分布及占路段总营收比例",
    "sql": "SELECT sa.service_area_name AS 服务区名称, SUM(bbd.pay_sum) AS 营收, ROUND(SUM(bbd.pay_sum)*100/(SELECT SUM(pay_sum) FROM bss_business_day_data WHERE oper_date >= CURRENT_DATE - INTERVAL '7 days' AND delete_ts IS NULL),2) AS 占比百分比 FROM bss_section_route sr JOIN bss_section_route_area_link link ON sr.id = link.section_route_id JOIN bss_service_area sa ON link.service_area_id = sa.id JOIN bss_business_day_data bbd ON sa.id = bbd.service_area_id WHERE sr.section_name = '昌栗' AND bbd.oper_date >= CURRENT_DATE - INTERVAL '7 days' AND bbd.delete_ts IS NULL GROUP BY sa.service_area_name ORDER BY 营收 DESC;"
  },
  {
    "question": "比较工作日与非工作日各路段平均日营收差异（按周日判断）",
    "sql": "SELECT sr.section_name AS 路段名称, CASE WHEN EXTRACT(DOW FROM bbd.oper_date) IN (0,6) THEN '节假日' ELSE '工作日' END AS 日类型, COUNT(*) AS 天数, SUM(bbd.pay_sum) AS 总营收, ROUND(AVG(bbd.pay_sum),2) AS 平均日营收 FROM bss_section_route sr JOIN bss_section_route_area_link link ON sr.id = link.section_route_id JOIN bss_business_day_data bbd ON link.service_area_id = bbd.service_area_id WHERE bbd.oper_date >= CURRENT_DATE - INTERVAL '1 month' AND bbd.delete_ts IS NULL GROUP BY sr.section_name, 日类型 ORDER BY 路段名称, 日类型;"
  },
  {
    "question": "展示近30天营收波动趋势（按日期汇总）",
    "sql": "SELECT oper_date AS 统计日期, SUM(pay_sum) AS 当日营收 FROM bss_business_day_data WHERE oper_date >= CURRENT_DATE - INTERVAL '30 days' AND delete_ts IS NULL GROUP BY oper_date ORDER BY 统计日期 ASC;"
  },
  {
    "question": "统计各路段关联服务区数量并按数量降序排列",
    "sql": "SELECT sr.section_name AS 路段名称, COUNT(link.service_area_id) AS 关联服务区数量 FROM bss_section_route sr JOIN bss_section_route_area_link link ON sr.id = link.section_route_id GROUP BY sr.section_name ORDER BY 关联服务区数量 DESC;"
  },
  {
    "question": "分析各路段不同支付方式占比（微信/支付宝/现金/其他）",
    "sql": "SELECT sr.section_name AS 路段名称, ROUND(SUM(bbd.wx)/SUM(bbd.pay_sum)*100,2) AS 微信占比, ROUND(SUM(bbd.zfb)/SUM(bbd.pay_sum)*100,2) AS 支付宝占比, ROUND(SUM(bbd.rmb)/SUM(bbd.pay_sum)*100,2) AS 现金占比, ROUND((SUM(bbd.xs)+SUM(bbd.jd))/SUM(bbd.pay_sum)*100,2) AS 其他占比 FROM bss_section_route sr JOIN bss_section_route_area_link link ON sr.id = link.section_route_id JOIN bss_business_day_data bbd ON link.service_area_id = bbd.service_area_id WHERE bbd.delete_ts IS NULL GROUP BY sr.section_name;"
  },
  {
    "question": "找出最近一个月环比增长率低于-10%的路段",
    "sql": "WITH monthly_revenue AS (SELECT sr.section_name, DATE_TRUNC('month', bbd.oper_date) AS 月份, SUM(bbd.pay_sum) AS 月营收 FROM bss_section_route sr JOIN bss_section_route_area_link link ON sr.id = link.section_route_id JOIN bss_business_day_data bbd ON link.service_area_id = bbd.service_area_id WHERE bbd.oper_date >= CURRENT_DATE - INTERVAL '2 months' AND bbd.delete_ts IS NULL GROUP BY sr.section_name, 月份) SELECT section_name AS 路段名称, 月份, 月营收, LAG(月营收,1) OVER (PARTITION BY section_name ORDER BY 月份) AS 上月营收, ROUND((月营收 - 上月营收)/NULLIF(上月营收,0)*100,2) AS 环比增长率 FROM monthly_revenue HAVING ROUND((月营收 - 上月营收)/NULLIF(上月营收,0)*100,2) < -10 ORDER BY 月份 DESC;"
  },
  {
    "question": "查询昌宁路段各服务区营收与车流关系（按周统计）",
    "sql": "SELECT sa.service_area_name AS 服务区名称, SUM(bbd.pay_sum) AS 周营收, SUM(car.customer_count) AS 周车流量, ROUND(SUM(bbd.pay_sum)/SUM(car.customer_count),2) AS 单位车流营收 FROM bss_section_route sr JOIN bss_section_route_area_link link ON sr.id = link.section_route_id JOIN bss_service_area sa ON link.service_area_id = sa.id JOIN bss_business_day_data bbd ON sa.id = bbd.service_area_id JOIN bss_car_day_count car ON bbd.service_area_id = car.service_area_id AND bbd.oper_date = car.count_date WHERE sr.section_name = '昌宁' AND bbd.oper_date >= CURRENT_DATE - INTERVAL '7 days' AND bbd.delete_ts IS NULL AND car.delete_ts IS NULL GROUP BY sa.service_area_name ORDER BY 周营收 DESC;"
  },
  {
    "question": "统计各高速公路分公司下属服务区的总营收占比，按降序排列",
    "sql": "SELECT c.company_name AS 所属公司, SUM(b.pay_sum) AS 总营收, (SUM(b.pay_sum) * 100 / (SELECT SUM(pay_sum) FROM bss_business_day_data WHERE delete_ts IS NULL))::numeric(5,2) AS 营收占比百分比 FROM bss_company c JOIN bss_service_area s ON c.id = s.company_id JOIN bss_business_day_data b ON s.service_area_name = b.service_name WHERE s.delete_ts IS NULL AND b.delete_ts IS NULL GROUP BY c.company_name ORDER BY 总营收 DESC;"
  },
  {
    "question": "对比信息化与智能化服务区的单区日均营收水平（仅统计开放状态）",
    "sql": "SELECT s.service_area_type AS 服务区类型, COUNT(DISTINCT s.id) AS 服务区数量, SUM(b.pay_sum) / COUNT(DISTINCT s.id) AS 单区日均营收 FROM bss_service_area s JOIN bss_business_day_data b ON s.service_area_name = b.service_name WHERE s.delete_ts IS NULL AND b.delete_ts IS NULL AND s.service_state = '开放' GROUP BY s.service_area_type;"
  },
  {
    "question": "计算各分公司服务区开放率（开放数量/总数），取TOP10",
    "sql": "SELECT c.company_name AS 所属公司, COUNT(CASE WHEN s.service_state = '开放' THEN 1 END) * 100 / COUNT(s.id) AS 开放率百分比 FROM bss_company c JOIN bss_service_area s ON c.id = s.company_id WHERE s.delete_ts IS NULL GROUP BY c.company_name ORDER BY 开放率百分比 DESC LIMIT 10;"
  },
  {
    "question": "统计过去7天各公司日均营收TOP10（按周计算）",
    "sql": "SELECT c.company_name AS 所属公司, AVG(daily_revenue) AS 日均营收 FROM (SELECT s.company_id, oper_date, SUM(pay_sum) AS daily_revenue FROM bss_service_area sa JOIN bss_business_day_data b ON sa.service_area_name = b.service_name WHERE b.oper_date >= CURRENT_DATE - INTERVAL '7 days' AND sa.delete_ts IS NULL AND b.delete_ts IS NULL GROUP BY sa.company_id, oper_date) t JOIN bss_company c ON t.company_id = c.id GROUP BY c.company_name ORDER BY 日均营收 DESC LIMIT 10;"
  },
  {
    "question": "分析近两月各公司营收环比增长率（本月营收/上月营收-1）",
    "sql": "WITH monthly_revenue AS (SELECT EXTRACT(MONTH FROM oper_date) AS month, sa.company_id, SUM(pay_sum) AS total_revenue FROM bss_service_area sa JOIN bss_business_day_data b ON sa.service_area_name = b.service_name WHERE oper_date >= DATE_TRUNC('month', CURRENT_DATE) - INTERVAL '2 months' AND sa.delete_ts IS NULL AND b.delete_ts IS NULL GROUP BY month, sa.company_id) SELECT m1.month AS 当前月份, c.company_name AS 所属公司, (m1.total_revenue / m2.total_revenue - 1) * 100 AS 环比增长率百分比 FROM monthly_revenue m1 JOIN monthly_revenue m2 ON m1.company_id = m2.company_id AND m1.month = m2.month + 1 JOIN bss_company c ON m1.company_id = c.id;"
  },
  {
    "question": "统计各公司现金支付占比（现金金额/总支付金额）",
    "sql": "SELECT c.company_name AS 所属公司, SUM(b.rmb) / SUM(b.pay_sum) * 100 AS 现金占比百分比 FROM bss_company c JOIN bss_service_area sa ON c.id = sa.company_id JOIN bss_business_day_data b ON sa.service_area_name = b.service_name WHERE sa.delete_ts IS NULL AND b.delete_ts IS NULL GROUP BY c.company_name;"
  },
  {
    "question": "查找单日营收最高的服务区及其所属公司",
    "sql": "SELECT sa.service_area_name AS 服务区名称, c.company_name AS 所属公司, MAX(b.pay_sum) AS 最高营收 FROM bss_service_area sa JOIN bss_business_day_data b ON sa.service_area_name = b.service_name JOIN bss_company c ON sa.company_id = c.id WHERE sa.delete_ts IS NULL AND b.delete_ts IS NULL GROUP BY sa.service_area_name, c.company_name ORDER BY 最高营收 DESC LIMIT 1;"
  },
  {
    "question": "统计各公司关闭状态服务区数量及占比",
    "sql": "SELECT c.company_name AS 所属公司, COUNT(CASE WHEN sa.service_state = '关闭' THEN 1 END) AS 关闭数量, (COUNT(CASE WHEN sa.service_state = '关闭' THEN 1 END) * 100 / COUNT(sa.id))::numeric(5,2) AS 关闭占比百分比 FROM bss_company c LEFT JOIN bss_service_area sa ON c.id = sa.company_id AND sa.delete_ts IS NULL GROUP BY c.company_name;"
  },
  {
    "question": "分析不同车辆类型对应服务区的营收分布（按危化品/城际/过境分类）",
    "sql": "SELECT cc.car_type AS 车辆类型, COUNT(DISTINCT cc.service_area_id) AS 涉及服务区, SUM(b.pay_sum) AS 总营收 FROM bss_car_day_count cc JOIN bss_service_area sa ON cc.service_area_id = sa.id JOIN bss_business_day_data b ON sa.service_area_name = b.service_name WHERE cc.delete_ts IS NULL AND sa.delete_ts IS NULL AND b.delete_ts IS NULL AND cc.car_type IN ('危化品','城际','过境') GROUP BY cc.car_type;"
  },
  {
    "question": "统计各公司订单数最多的日期及当日总订单量",
    "sql": "SELECT t.* FROM (SELECT c.company_name AS 所属公司, b.oper_date AS 日期, SUM(b.order_sum) AS 总订单量 FROM bss_company c JOIN bss_service_area sa ON c.id = sa.company_id JOIN bss_business_day_data b ON sa.service_area_name = b.service_name WHERE sa.delete_ts IS NULL AND b.delete_ts IS NULL GROUP BY c.company_name, b.oper_date) t JOIN (SELECT company_name, MAX(总订单量) AS max_order FROM (SELECT c.company_name AS company_name, b.oper_date AS oper_date, SUM(b.order_sum) AS 总订单量 FROM bss_company c JOIN bss_service_area sa ON c.id = sa.company_id JOIN bss_business_day_data b ON sa.service_area_name = b.service_name WHERE sa.delete_ts IS NULL AND b.delete_ts IS NULL GROUP BY c.company_name, b.oper_date) sub GROUP BY company_name) tmp ON t.company_name = tmp.company_name AND t.总订单量 = tmp.max_order;"
  },
  {
    "question": "统计各服务区档口的客单价（总支付金额/订单总数），按客单价降序排列",
    "sql": "SELECT b.service_name AS 服务区名称, b.branch_name AS 档口名称, SUM(b.pay_sum) / SUM(b.order_sum) AS 客单价 FROM bss_business_day_data b WHERE b.delete_ts IS NULL GROUP BY b.service_name, b.branch_name ORDER BY 客单价 DESC;"
  },
  {
    "question": "计算不同数据来源系统的渠道转化率（微信订单数/总订单数），展示TOP5系统",
    "sql": "SELECT m.source_system_type AS 数据来源系统, SUM(b.wx_order) * 1.0 / SUM(b.order_sum) AS 微信转化率 FROM bss_business_day_data b INNER JOIN bss_service_area_mapper m ON b.service_no = m.service_no WHERE b.delete_ts IS NULL GROUP BY m.source_system_type ORDER BY 微信转化率 DESC LIMIT 5;"
  },
  {
    "question": "分析最近7天各服务区支付宝支付金额占比变化趋势",
    "sql": "SELECT oper_date AS 统计日期, service_name AS 服务区名称, SUM(zfb) * 100.0 / SUM(pay_sum) AS 支付宝占比 FROM bss_business_day_data WHERE delete_ts IS NULL AND oper_date >= CURRENT_DATE - 7 GROUP BY oper_date, service_name ORDER BY 统计日期 DESC;"
  },
  {
    "question": "对比不同服务区类型的现金支付占比差异",
    "sql": "SELECT s.service_area_type AS 服务区类型, AVG(b.rmb * 100.0 / b.pay_sum) AS 现金占比 FROM bss_service_area s INNER JOIN bss_business_day_data b ON s.service_area_no = b.service_no WHERE s.delete_ts IS NULL AND b.delete_ts IS NULL GROUP BY s.service_area_type;"
  },
  {
    "question": "查询2023年Q2季度订单总数超过1000的档口信息",
    "sql": "SELECT service_name AS 服务区名称, branch_name AS 档口名称, SUM(order_sum) AS 总订单数 FROM bss_business_day_data WHERE delete_ts IS NULL AND oper_date BETWEEN '2023-04-01' AND '2023-06-30' GROUP BY service_name, branch_name HAVING SUM(order_sum) > 1000;"
  },
  {
    "question": "找出微信支付金额占比连续3个月下降的档口",
    "sql": "WITH wx_trend AS (SELECT branch_name, EXTRACT(MONTH FROM oper_date) AS 月份, SUM(wx) * 100.0 / SUM(pay_sum) AS 微信占比 FROM bss_business_day_data WHERE delete_ts IS NULL GROUP BY branch_name, 月份) SELECT branch_name FROM wx_trend WHERE 月份 BETWEEN 1 AND 3 ORDER BY branch_name HAVING (ARRAY_AGG(微信占比 ORDER BY 月份 DESC))[1] < (ARRAY_AGG(微信占比 ORDER BY 月份 DESC))[2] AND (ARRAY_AGG(微信占比 ORDER BY 月份 DESC))[2] < (ARRAY_AGG(微信占比 ORDER BY 月份 DESC))[3];"
  },
  {
    "question": "统计各公司下属服务区档口的平均行吧支付订单数",
    "sql": "SELECT c.company_name AS 公司名称, COUNT(DISTINCT b.service_name) AS 服务区数量, AVG(SUM(xs_order)) OVER (PARTITION BY c.company_name) AS 日均行吧订单数 FROM bss_company c INNER JOIN bss_service_area s ON c.id = s.company_id INNER JOIN bss_business_day_data b ON s.service_area_no = b.service_no WHERE c.delete_ts IS NULL GROUP BY c.company_name;"
  },
  {
    "question": "查询2023年6月1日庐山服务区各档口订单数排名",
    "sql": "SELECT branch_name AS 档口名称, order_sum AS 订单数量 FROM bss_business_day_data WHERE delete_ts IS NULL AND oper_date = '2023-06-01' AND service_name = '庐山服务区' ORDER BY order_sum DESC;"
  },
  {
    "question": "分析危化品车辆占比对档口销售额的影响（按月统计）",
    "sql": "WITH car_ratio AS (SELECT EXTRACT(MONTH FROM count_date) AS 月份, SUM(CASE WHEN car_type = '危化品' THEN customer_count ELSE 0 END) * 100.0 / SUM(customer_count) AS 危化品占比 FROM bss_car_day_count GROUP BY 月份) SELECT c.月份, AVG(b.pay_sum) AS 平均销售额, c.危化品占比 FROM car_ratio c INNER JOIN bss_business_day_data b ON EXTRACT(MONTH FROM b.oper_date) = c.月份 GROUP BY c.月份, c.危化品占比;"
  },
  {
    "question": "找出最近30天无现金支付记录的档口名单",
    "sql": "SELECT DISTINCT branch_name AS 档口名称 FROM bss_business_day_data WHERE delete_ts IS NULL AND oper_date >= CURRENT_DATE - 30 EXCEPT SELECT DISTINCT branch_name FROM bss_business_day_data WHERE delete_ts IS NULL AND rmb > 0 AND oper_date >= CURRENT_DATE - 30;"
  }
]